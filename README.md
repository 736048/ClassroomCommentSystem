# CCS (Classroom Comment System)

授業、セミナー、プレゼンテーションにおいて、参加者のリアルタイムな反応を投影画面へ統合するためのデスクトップ・オーバーレイ・アプリケーションです。Electronフレームワークを基盤とし、全画面スライドショーの上にも透過的にコメントや図形を重畳表示できます。

---

## 主要機能

### 1. リアルタイム・コメント投影
*   **ホタル表示アルゴリズム**: コメントはスクロールせず、画面上のランダムな位置にフェードインし、一定時間滞在したあとフェードアウトします。
*   **自動視認性調整**: 文字色に合わせて黒または白の縁取り（text-shadow）を自動適用し、どんな背景のスライドでも読みやすく表示します。
*   **固定コメント機能**: 重要なコメントを画面上の特定の場所に固定して表示し続けることができます。

### 2. インタラクティブ描画・管理
*   **図形描画ツール**: 丸（●）、四角（■）、直線（／）を画面上の任意の場所に配置できます。色は6色から選択可能です。
*   **ドラッグ＆リサイズ**: 配置した図形や固定コメントは、管理画面のプレビュー上でドラッグして移動させたり、ハンドルを操作してリサイズしたりできます。
*   **画面キャプチャ・プレビュー**: 管理画面上で実際に投影している画面をリアルタイムに確認しながら操作できます。

### 3. PowerPoint連携 (macOS)
*   **ノート同期**: スライドショー実行中、現在のスライドの発表者ノートを自動的に取得して管理画面に表示します（「同期ON」トグルで切り替え）。
*   **スライド操作**: 管理画面のボタン、またはキーボード操作でPowerPointのスライドを前後に移動できます。

### 4. 運用・セキュリティ
*   **QRコード生成**: 参加者がスマートフォンなどで即座にアクセスできるURLをQRコードとして画面に大写しできます。
*   **NGワードフィルタ**: 不適切な言葉を含むコメントを自動的にブロックします（`server/ng_words.json` で管理）。
*   **生徒用カラー設定**: 先生側から生徒が送信するコメントのデフォルト色を一括で指定できます。
*   **経過時間タイマー**: 発表の残り時間や経過時間を管理するためのタイマーを搭載しています。

---

## 操作方法

### キーボードショートカット
管理画面がアクティブな状態で以下のキーが使用可能です：

| キー | アクション |
| :--- | :--- |
| `→` / `Space` / `Enter` / `PageDown` | 次のスライドへ（PowerPoint） |
| `←` / `PageUp` | 前のスライドへ（PowerPoint） |
| `Delete` / `Backspace` | 選択中の図形または固定コメントを削除 |

### 投影のコツ
1. アプリを起動すると、自動的に2番目のディスプレイ（外部出力）を探して投影用ウィンドウを配置します。
2. 投影したい画面（PowerPointを映している画面）を管理画面の「画面選択」ボックスから選択して「更新」を押してください。
3. PowerPointのスライドショーを開始した後、管理画面の「補助」タブにある「同期ON」を有効にすると、ノートが手元で確認できるようになります。

---

## 技術スタック
*   **Runtime**: Node.js
*   **Framework**: Electron
*   **Communication**: Socket.io (WebSocketによる双方向通信)
*   **Backend**: Express
*   **Automation**: AppleScript (PowerPoint制御用)

---

## セットアップ

### システム要件
*   **OS**: macOS (PowerPoint連携機能にAppleScriptを使用するため)
*   **Node.js**: LTS推奨

### インストール
```bash
npm install
```

### 実行
```bash
npm start
```

### macOSでの注意点（画面収録の権限）
初回起動時や画面プレビューが真っ暗な場合、OSのセキュリティ設定が必要です：
1. 「システム設定」 > 「プライバシーとセキュリティ」 > 「画面収録」を開きます。
2. アプリ（または実行しているターミナル）の権限を一度「オフ」にしてから「オン」に設定してください。
3. アプリを再起動します。

---

## ファイル構成
*   `main.js`: Electronメインプロセス。ウィンドウ管理、PowerPoint通信、サーバー制御。
*   `server/app.js`: 通信サーバー。コメントの配信、NGワード処理。
*   `renderer/control.js`: 先生用管理画面のロジック。
*   `renderer/overlay.js`: 投影画面（オーバーレイ）の描画ロジック。
*   `public/`: 生徒がアクセスするWeb投稿画面。

---

## ライセンス
ISC License