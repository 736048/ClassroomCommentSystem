# Classroom Comment System (CCS)

CCS（Classroom Comment System）は、授業や講演、プレゼンテーションをよりインタラクティブにするためのデスクトップ・オーバーレイ・アプリケーションです。プロジェクターに映し出されたプレゼン資料を妨げることなく、参加者からのリアルタイムなコメントや、発表者による図形注釈、PowerPointの発表者ノートなどを透過的に重ねて表示します。

---

## 1. アプリの説明
本アプリケーションは、Electronフレームワークを活用したデスクトップアプリと、Node.jsベースのWebサーバーが統合されたシステムです。
- **背景**: 従来のプレゼンでは一方通行になりがちですが、本ツールを使うことで参加者は自分のデバイスから匿名で反応を送信でき、発表者はその反応を即座に視覚化できます。
- **特徴**: コメントがスライドを遮らない「蛍（ホタル）表示」アルゴリズムや、PowerPointと高度に連携したノート表示機能など、教育現場やビジネスシーンでの利用に特化した設計となっています。

---

## 2. アプリの操作方法

### 基本的な流れ
1. アプリを起動すると「管理画面」と「投影用画面」の2つのウィンドウが開きます。
2. 管理画面で「QRコード表示」をクリックし、参加者に投稿用URLを共有します。
3. 参加者がメッセージを送ると、投影用画面に自動的にコメントが表示されます。

### 管理画面のタブ機能
- **コメントタブ**:
    - 送信されたコメントの履歴確認。
    - 発表者（先生）からのメッセージ送信。
    - 「詳細設定」からフォント（ゴシック/明朝）、サイズ（標準/大）、色の変更。
    - 「生徒の文字色」変更により、参加者のコメント色を一括管理。
- **補助タブ**:
    - PowerPointのスライド操作（戻る/進む）。
    - **同期ON/OFF**: PowerPointの発表者ノートをリアルタイムで手元に表示します。

### キーボードショートカット（管理画面アクティブ時）
| キー | アクション |
| :--- | :--- |
| `Enter` / `Space` / `→` / `PageDown` | 次のスライドへ（PowerPoint） |
| `←` / `PageUp` | 前のスライドへ（PowerPoint） |
| `Delete` / `Backspace` | 選択中の図形または固定コメントを削除 |

---

## 3. 使用技術の構成（エンジニア向け）
本システムはモダンなWeb技術とデスクトップアプリ機能を組み合わせて構築されています。

- **ランタイム**: Node.js
- **フレームワーク**: Electron (デスクトップ環境でのウィンドウ制御、画面キャプチャ)
- **サーバー**: Express (生徒用Webクライアントの配信)
- **リアルタイム通信**: Socket.io (WebSocketによる双方向低遅延通信)
- **プレゼン制御**: AppleScript / osascript (macOS上のMicrosoft PowerPointのプロセス制御)
- **フロントエンド**: 
    - **描画**: Web Animations API (CPU負荷を抑えた滑らかなコメントアニメーション)
    - **座標系**: 投影画面と管理画面間でパーセンテージベース（0-100%）の相対座標を採用
    - **スタイリング**: CSS Custom Propertiesによる動的なテーマ管理

---

## 4. 機能の説明

### コメント投影システム
- **蛍（ホタル）方式**: コメントが画面のあちこちにふわっと現れて消えます。スライドの文字を隠しにくく、視線移動を促します。
- **固定コメント**: 特定のメッセージを画面の指定位置にずっと表示させることができます。ドラッグで移動、端を掴んでリサイズが可能です。

### インタラクティブ注釈
- **図形描画**: 丸、四角、直線の図形を画面に書き込めます。強調したいポイントにリアルタイムで注釈を入れられます。
- **画面プレビュー**: 管理画面内で、今プロジェクターに映っている内容をビデオ形式で確認しながら、ミリ単位の操作が可能です。

### 運用支援ツール
- **PPTノート同期**: 発表者ノートを管理画面に表示します。PowerPointを全画面表示していても、手元のPCでノートを確認できます。
- **NGワードフィルタ**: サーバーサイドで投稿内容を監視し、不適切な言葉を自動的に遮断します。リストは `ng_words.json` に保存されます。
- **経過時間タイマー**: プレゼンの経過時間をカウントします。
- **ポート変更**: ネットワーク環境に合わせて、通信に使用するポート番号を動作中に変更可能です。

---

## 5. ファイル構成（エンジニア向け）
```text
ClassroomCommentSystem/
├── main.js             # Electronメインプロセス。ウィンドウ管理、IPC、PPT制御
├── package.json        # 依存ライブラリ、起動スクリプトの定義
├── server/
│   ├── app.js          # Socket.ioサーバー、Express配信、NGワード処理
│   └── ng_words.json   # フィルタリングする言葉のリスト
├── renderer/
│   ├── control.html/js # 発表者用管理画面（操作ロジック、UI）
│   ├── overlay.html/js # 投影用ウィンドウ（アニメーション、描画）
│   └── overlay.css     # 投影画面のデザイン（text-shadow等の可読性処理）
└── public/
    ├── index.html/js   # 生徒（参加者）がスマホ等で開く投稿画面
    └── style.css       # 投稿画面のデザイン
```

---

## 6. アプリの導入・設定（非エンジニア向け）

専門的な知識がなくても、以下の手順でアプリを使い始めることができます。

### 導入の手順
1.  **Node.jsのインストール**:
    - [Node.js公式サイト](https://nodejs.org/ja/)から「LTS（推奨版）」をダウンロードしてインストールしてください。
2.  **ファイルの準備**:
    - このアプリのフォルダ（ZIP）をダウンロードして、デスクトップなどに解凍します。
3.  **アプリの準備（最初の一回だけ）**:
    - 「ターミナル」アプリを開き、解凍したフォルダをターミナルへドラッグ＆ドロップします。
    - `npm install` と入力してEnterキーを押し、終わるまで待ちます。
4.  **アプリの起動**:
    - ターミナルで `npm start` と入力してEnterキーを押すとアプリが立ち上がります。

### Macのシステム設定（重要）
アプリが正しく動くように、以下の2つの許可設定を行ってください。

1.  **「画面収録」の許可**:
    - 理由：管理画面でプレゼン画面を確認するために必要です。
    - 方法：「システム設定」＞「プライバシーとセキュリティ」＞「画面収録」を開き、一覧にあるアプリ（またはターミナル）を **オン** にします。
    - ※すでにオンの場合は一度オフにしてから再度オンにしてください。
2.  **「アクセシビリティ」の許可**:
    - 理由：PowerPointのスライドを動かすために必要です。
    - 方法：「システム設定」＞「プライバシーとセキュリティ」＞「アクセシビリティ」を開き、同様に **オン** にします。

---

## ライセンス
ISC License